{
  "hash": "3849c3b5c99ee1c4070b0729ad64c0b5",
  "result": {
    "markdown": "---\ntitle: \"Data Sources\"\nformat: html\nexecute:\n  echo: fenced\n---\n\n\n## Overview\n\nThere are a wide variety of way to make data available to OJS:\n\n-   Read CSV, JSON, SQLite, and more using the [FileAttachments](https://github.com/observablehq/stdlib#file-attachments) API.\n\n-   Use the `ojs_define()` function to make data processed in Python or R available to `{ojs}` cells.\n\n-   Make calls to Web APIs for online services and data stores.\n\nWe'll explore all of these techniques below.\n\n## File Attachments\n\nUse the [FileAttachment](https://github.com/observablehq/stdlib#file-attachments) function from the standard library to read data from a file. For example, here we read and plot a CSV of NOAA's Monthly [CO2 concentration data](https://gml.noaa.gov/ccgg/trends/data.html) from Mauna Loa:\n\n\n```{ojs}\ndata = {\n  const co2data = await FileAttachment(\"co2_mm.csv\")\n    .csv({ typed: true } );\n  return co2data.map(d => { \n    d[\"decimal date\"] = Number(d[\"decimal date\"]);\n    d.average = Number(d.average); \n    return d; \n  });\n}\nPlot.plot({\n  marks: [\n    Plot.line(data, \n      { x: \"decimal date\", y: \"average\"}, \n      { stroke: \"black\" }\n    )\n  ]\n})\n```\n\n\nNote that we specified the `typed: true` option to the `csv()` function. When this option is specified [d3.autoType](https://observablehq.com/@d3/d3-autotype) is used to automatically detect numbers, dates, etc. and convert them to the correct JavaScript types. This is highly recommend when you know that your data is compatible with automatic type detection.\n\nHere are the methods available for structured data formats:\n\n| Method                                                                                                                       | Description                          |\n|------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n| [csv](https://github.com/observablehq/stdlib#attachment_csv)                                                                 | Comma separated values               |\n| [tsv](https://github.com/observablehq/stdlib#attachment_tsv)                                                                 | Tab separated values                 |\n| [json](https://github.com/observablehq/stdlib#attachment_json)                                                               | JSON (JavaScript objects)            |\n| [sqlite](https://github.com/observablehq/stdlib#attachment_sqlite)                                                           | SQLite database client               |\n| [arrow](https://github.com/observablehq/stdlib/blob/8d9f4d18df0b237a5e0870a6f39584048007aca7/src/fileAttachment.mjs#L59-L62) | Apache Arrow IPC file (uncompressed) |\n\nThere are also methods to get the raw data as a [blob](https://github.com/observablehq/stdlib#attachment_blob), [text](https://github.com/observablehq/stdlib#attachment_text), [image](https://github.com/observablehq/stdlib#attachment_image), or [stream](https://github.com/observablehq/stdlib#attachment_stream).\n\nNote that if you are using the `arrow()` method the Apache Arrow IPC file (Feather V2 file) should be written uncompressed. For example:\n\n```` markdown\n```{{r}}\narrow::write_feather(\n  mtcars, \n  \"data.arrow\", \n  compression = \"uncompressed\"\n)\n```\n\n```{{ojs}}\ndata = FileAttachment(\"data.arrow\").arrow()\n```\n````\n\n## Python and R\n\nThe data you want to use with OJS might not always be available in raw form. Often you'll need to read and preprocess the raw data using Python or R. You can perform this preprocessing during document render (in an `{r}` or `{python}` code cell) and then make it available to `{ojs}` cells via the `ojs_define()` function.\n\nHere's an example. We'll read the same data into R, do some grouping and summarization, then make it available to OJS using `ojs_define`:\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| output: false\n\nlibrary(readr)\nlibrary(dplyr)\n\nco2 = read_csv(\"co2_mm.csv\")  %>% \n  group_by(year) %>% \n  summarize(max = max(average))\n\nojs_define(co2data = co2)\n```\n````\n:::\n\n\nNote that we could have done the same thing using Python (the `ojs_define` function is available in any document that uses R or Python).\n\nNow we plot the data using [Observable Plot](https://github.com/observablehq/plot):\n\n\n```{ojs}\nyearlyChart = Plot.plot({\n  marks: [\n    Plot.line(transpose(co2data), \n      {x: \"year\", y: \"max\"}, \n      { stroke: \"black\" }\n    )\n  ]}\n)\n```\n\n\nSee the [NOAA C02](examples/noaa-co2.qmd) example for the full source code.\n\n### Transpose\n\nYou'll note one additional twist in the OJS code above: we call the `transpose` function on our `co2data` before plotting it. The `transpose` function is built in to Quarto's OJS engine, and will convert column-oriented datasets (like the ones used in Python and R) into the row-oriented datasets used by many JavaScript plotting libraries (including [Plot](https://github.com/observablehq/plot)).\n\nFor example, the following JSON data emitted from R or Python:\n\n``` json\n{\n  \"year\": [1958, 1959, 1960],\n  \"max\":  [317.51, 318.29, 320.04]\n}\n```\n\nIs converted to the following via the call to `transpose`:\n\n``` json\n[\n  { \"year\": 1959, \"max\": 317.51 },\n  { \"year\": 1960, \"max\": 318.29 },\n  { \"year\": 1960, \"max\": 320.04 }\n]\n```\n\nCheck the documentation for whatever plotting library you are using from OJS to see whether a call to `transpose` is required.\n\n## Web APIs\n\nYou can use the [`d3.json()`](https://github.com/d3/d3-fetch/blob/v3.0.1/README.md#json) function to read JSON data from web services and data sources. Here we query the GitHub API for data on contributions to the Python pandas package:\n\n\n```{ojs}\nd3 = require('d3')\n\ncontributors = await d3.json(\n  \"https://api.github.com/repos/pandas-dev/pandas/stats/contributors\"\n)\n\ncommits = contributors.map(contributor => {\n  const author = contributor.author;\n  return {\n    name: author.login,\n    title: author.login,\n    group: author.type,\n    value: contributor.total\n  }\n})\n```\n\n\nView the data sorted by number of commits:\n\n\n```{ojs}\nInputs.table(commits, { sort: \"value\", reverse: true })\n```\n\n\nSee the [GitHub API](examples/github.qmd) example for the full source code.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script type=\"ojs-define\">\n{\"contents\":[{\"name\":\"co2data\",\"value\":{\"year\":[1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021],\"max\":[317.51,318.29,320.04,320.58,321.02,322.25,322.26,322.17,324.08,325,325.57,327.38,328.13,328.93,330.07,332.48,333.19,333.95,334.74,336.93,338.02,339.26,341.45,343.04,344.77,346.14,347.78,349.28,350.52,352.15,354.35,355.95,357.38,359.23,359.71,360.3,361.78,363.83,365.25,366.77,369.56,371.15,371.98,374.03,375.93,378.78,380.8,382.64,385.22,386.78,388.78,390.36,393.21,394.41,396.93,400.02,401.96,404.15,407.9,409.89,411.44,414.86,417.31,419.13]}}]}\n</script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}